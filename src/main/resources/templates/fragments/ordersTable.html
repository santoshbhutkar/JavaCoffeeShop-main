<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <body>
    <div th:fragment="ordersTable">
      <div class="panel panel-default">
        <div class="panel-heading">
          <span class="lead">List of Orders</span>
        </div>
        <div class="panel-body" th:if="${#lists.isEmpty(orders)}">
          <div class="alert alert-warning" style="margin-bottom: 0">No orders found.</div>
        </div>
        <table class="table table-hover" th:if="${!#lists.isEmpty(orders)}">
          <thead>
            <tr>
              <th width="70">ID</th>
              <th width="120">Date</th>
              <th width="200">Person</th>
              <th width="120">Total Amount</th>
              <th>Products</th>
              <th width="120">QR Code</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="order : ${orders}">
              <td th:text="${order.id}">ID</td>
              <td th:text="${order.orderDate}">Date</td>
              <td th:text="${order.person.username}">Username</td>
              <td th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)}">##.##</td>
              <td>
                <ul>
                  <li th:each="orderLine : ${order.orderLines}"
                      th:text="${orderLine.productName + ' (' + orderLine.quantity + ')'}"></li>
                </ul>
              </td>
              <td>
                <a th:href="@{/orders/{id}/qrcode(id=${order.id})}" 
                   target="_blank" 
                   title="View QR Code">
                  <img th:src="@{/orders/{id}/qrcode(id=${order.id})}" 
                       alt="QR Code" 
                       style="width: 80px; height: 80px; border: 1px solid #ddd; padding: 5px; background: white;" />
                </a>
                <br/>
                <small>
                  <a th:href="@{/orders/{id}/qrcode(id=${order.id})}" 
                     th:download="'order-' + ${order.id} + '-qrcode.png'"
                     class="btn btn-xs btn-default"
                     style="margin-top: 5px;">
                    <span class="glyphicon glyphicon-download" aria-hidden="true"></span> Download
                  </a>
                </small>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>